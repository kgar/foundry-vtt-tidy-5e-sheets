<script lang="ts">
  import AcShieldBase from './AcShieldBase.svelte';
  import { getContext, onMount } from 'svelte';
  import type { Readable } from 'svelte/store';
  import type { ActorSheetContextV1 } from 'src/types/types';
  import { FoundryAdapter } from 'src/foundry/foundry-adapter';
  import { CONSTANTS } from 'src/constants';

  /**
   * The Armor Class value.
   */
  export let ac: string | number = '0';

  /**
   * Optional CSS class list string to apply to the AC Shield container element.
   */
  export let cssClass: string = '';

  let context = getContext<Readable<ActorSheetContextV1>>(
    CONSTANTS.SVELTE_CONTEXT.CONTEXT,
  );

  let acShieldButton: HTMLElement;

  onMount(() => {
    $context.actor.sheet._applyAttributionTooltips(acShieldButton);
  });
</script>

<AcShieldBase {cssClass}>
  <!-- svelte-ignore a11y-click-events-have-key-events -->
  <!-- svelte-ignore a11y-no-static-element-interactions -->
  <!-- svelte-ignore a11y-missing-attribute -->
  <a
    bind:this={acShieldButton}
    on:click={() =>
      $context.editable && FoundryAdapter.renderArmorConfig($context.actor)}
    on:focus
    class="config-button attribute-value transparent-button"
    data-attribution="attributes.ac"
    data-attribution-caption="DND5E.ArmorClass"
    data-tooltip-direction="DOWN"
  >
    {ac}
  </a>
</AcShieldBase>

<style lang="scss">
  .attribute-value {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 2.25rem;
    font-weight: 700;
  }
</style>
